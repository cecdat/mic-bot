# Mic-Bot - 分布式执行节点

这是一个基于 TypeScript 和 Playwright 的 Microsoft Rewards 自动化脚本。在当前架构下，它被设计为一个**纯粹的、7x24小时在线的“工作节点”**，其所有的配置、任务调度和推送逻辑，都由中央的 **`points_api_server` (指挥中心)** 统一管理。

**重要提示**: 本项目无法独立运行。它必须连接到一个已部署并正确配置的 `points_api_server` 实例才能工作。

## ⚙️ 核心工作模式：守护进程与长轮询

与旧版本不同，`mic-bot` 不再依赖 Cron 进行定时任务。它现在是一个**常驻服务（守护进程）**，其核心工作流程如下：

1.  **启动与签到**: 容器启动后，`mic-bot` 会立即向指挥中心进行“签到”，报告自己已上线，并进入待机状态。
2.  **心跳维持**: 程序会按照您在 `config.json` 中配置的 `heartbeatInterval` 间隔，定期向服务器发送心跳，以维持其“在线”状态。
3.  **长轮询指令**: 在待机期间，`mic-bot` 会持续地向指挥中心的一个长轮询接口发送请求，并最长等待约一分钟，以“监听”来自服务器的指令。
4.  **接收并执行任务**:
    * 当您在指挥中心的网页上手动触发“运行”按钮时，服务器会通过长轮询立即向对应的节点下发 `RUN_TASKS` 指令。
    * `mic-bot` 收到指令后，会立即向服务器报告自己的状态为“运行中”。
    * 接着，它会从服务器获取分配给自己的账户列表，并开始执行所有自动化任务。
5.  **完成并返回待机**: 所有账户的任务都执行完毕后，`mic-bot` 会向服务器报告自己的状态已变回“待机”，然后立即进入下一次的长轮询，等待新的指令。

## 🚀 部署与配置

部署 `mic-bot` 节点非常简单：

### 1. 准备环境
* 一台可以访问外网的设备（本地PC、服务器、NAS等）。
* 已安装 [Docker](https://get.docker.com/) 和 [Docker Compose](https://docs.docker.com/compose/install/)。

### 2. 获取并配置项目
* 将本项目的全部文件下载或克隆到您的设备上。
* **获取API Token**:
    1.  登录到您的 `points_api_server` 指挥中心网页。
    2.  导航到“**节点管理**”页面。
    3.  点击“**新增节点**”，输入一个唯一的节点名称（例如 `MyHomePC`），然后点击创建。
    4.  在弹出的窗口中，**复制生成的唯一 API Token**。
* **编辑配置文件**:
    1.  打开项目中的 `src/config.json` 文件。
    2.  找到 `apiServer` 部分。
    3.  将 `updateUrl` 修改为您指挥中心的地址（例如 `http://123.45.67.89:2002`）。
    4.  将 `nodeName` 修改为您刚刚在网页上创建的、完全相同的节点名称。
    5.  将 `token` 字段的值替换为您刚刚复制的**唯一 API Token**。

### 3. 构建并启动服务
* 在 `mic-bot` 项目的根目录下，执行以下命令：
    ```bash
    docker-compose up -d --build
    ```

### 4. 验证
* 查看 `mic-bot` 的日志 (`docker logs -f mic-bot-node`)，您应该能看到它成功启动并开始请求指令。
* 回到 `points_api_server` 的“节点管理”页面，您应该能看到该节点的状态变为“在线”和“待机”。

至此，您的 `mic-bot` 执行节点已成功部署并连接到指挥中心，随时准备接收任务。

## ⚠️ 免责声明
使用此脚本可能会导致您的微软账户被封禁或暂停，请您自行承担风险！
